---
title: '2025.01.13-2025.01.19 学习内容'
date: 2025-01-15
permalink: /posts/2025/1/blog-post-2/
tags:
  - Arm
  - 超级优化
  - C++
  - 向量寄存器
---

对超级优化项目进行debug。

## 1、mov指令立即数范围问题

问题出现在对立即数的解析，报错信息为：

```
[2025-01-15 08:21:13.420] [debug] w11
[2025-01-15 08:29:31.430] [debug] #0x80000000
[2025-01-15 08:29:35.137] [error] imm out of range: the 1-th operand of mov
Syntax Error: imm out of range
terminate called after throwing an instance of 'std::runtime_error'
  what():  Parser Syntax Error at line : 3
[1] + Done                       "/usr/bin/gdb" --interpreter=mi --tty=${DbgTerm} 0<"/tmp/Microsoft-MIEngine-In-2tlxh2ri.1gq" 1>"/tmp/Microsoft-MIEngine-Out-w1kwel15.21w"
```

定位原因在于，对立即数字符串的解析没有进行区分。例如，对于`mov w11, #0x80000000`，会把`0x80000000`解析为`2147483648`，而不是`-2147483648`，导致判定指令是否合法（立即数是否在允许范围内，也就是[-2147483648, 2147483647]）时报错。

相关函数片段如下：

```c++
......
int64_t value = parse_number(imm_str);
......
......
    if (lo <= value && value <= hi) {
		......
    } else {
      	spdlog::error("imm out of range: the {}-th operand of {}", op_id,
                    inst_id_str);
      	......
    }
......
```

需要对解析函数进行修改，使得返回多个可能的值，或者根据当前已经解析出的InstType补充判断逻辑，使用不同的解析数字字符串函数。
